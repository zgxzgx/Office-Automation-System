<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="utf-8" />
    <title>发文稿纸信息</title>
    <meta name="keywords" content="" />
    <meta name="description" content="" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

    <script th:replace="header :: header"></script>

</head>

<body>
<script>

    var userbase64 = "[[${userbase64}]]";

</script>

<div th:replace="navbar :: navbar(${session.user})"></div>

<div class="main-container" id="main-container">
    <script type="text/javascript">
        try{ace.settings.check('main-container' , 'fixed')}catch(e){}
    </script>

    <div class="main-container-inner">
        <a class="menu-toggler" id="menu-toggler" href="#">
            <span class="menu-text"></span>
        </a>


        <div th:replace="slider :: slidermenu(${'dbzx'})"></div>


        <div class="main-content">
            <div class="breadcrumbs" id="breadcrumbs">
                <script type="text/javascript">
                    try{ace.settings.check('breadcrumbs' , 'fixed')}catch(e){}
                </script>

                <ul class="breadcrumb">
                    <li>
                        <i class="icon-home home-icon"></i>
                        <a href="/">首页</a>
                    </li>
                    <li class="#">发文稿纸</li>
                </ul><!-- .breadcrumb -->

                <div class="nav-search" id="nav-search">
                    <form class="form-search">
                                        <span class="input-icon">
                                            <input type="text" placeholder="Search ..." class="nav-search-input" id="nav-search-input" autocomplete="off" />
                                            <i class="icon-search nav-search-icon"></i>
                                        </span>
                    </form>
                </div><!-- #nav-search -->
            </div>

            <div class="page-content">


                <!-- /.page-header -->

                    <div class="col-xs-12">
                        <!-- PAGE CONTENT BEGINS -->

                        <div style="height: 1400px">
                            <img th:src=@{/api/bgPng/small/missivePublish/{instanceID}(instanceID=${instanceID})}
                                 th:if="${hasBgPng}"
                                 style="float:left;position:absolute;top:0px;left:14px;width:1030px;height:1460px;"/>

                            <div style="width:891px;height:1260px;position:absolute;margin-left: 70px;margin-top:100px;background-image: url('/img/missivePublish_small.png');background-size:contain;background-repeat:no-repeat;z-index: -1">
                                <!-- PAGE CONTENT BEGINS -->
                                <div id="missiveForm" style="font-family:'微软雅黑';width:891px;height:1260px;z-index: -1;border-style:solid;border-color:red;border-width: 0.5px;" >

                                    <div style="height: 30px;width: 26px;top: 112px;position: absolute;left: 168px;text-align: center;">
                                        <label style="color: red;font-size: 19px;font-family:'微软雅黑';" th:text="${missiveNumber1!=null?missiveNumber1:''}"></label>
                                    </div>
                                    <div style="height: 30px;width: 53px;top: 112px;position: absolute;left: 200px;text-align: center;">
                                        <label th:text="${missiveNumber2!=null?missiveNumber2:''}" style=" font-family:'微软雅黑';"></label>
                                    </div>
                                    <div style="height: 30px;width: 43px;top: 112px;position: absolute;left: 260px;text-align: center;">
                                        <label th:text="${missiveNumber3!=null?missiveNumber3:''}" style=" font-family:'微软雅黑';"></label>
                                    </div>
                                    <!--<div style="height: 40px;width: 100px;top: 113px;left: 480px;position: absolute;">-->
                                        <!--<label style="font-family:'微软雅黑';"-->
                                               <!--th:text="${missivePublishForm.missiveInfo.secretLevel.secretLevelName!=null?missivePublishForm.missiveInfo.secretLevel.secretLevelName:''}">-->

                                        <!--</label>-->
                                    <!--</div>-->
                                    <div style="height: 40px;width: 100px;top: 112px;left: 720px;position: absolute;">
                                        <label style="font-family:'微软雅黑';" th:text="${missivePublishForm.missiveInfo.missiveType.typeName!=null?missivePublishForm.missiveInfo.missiveType.typeName:''}">

                                        </label>
                                    </div>
                                    <!--签发place-->
                                    <div style="height: 458px;width: 825px;top: 155px;left: 33px;position: absolute;">
                                        <img th:src="${missivePublishForm.signIssueContent!=null
                        &&missivePublishForm.signIssueContent.imageurl!=null?missivePublishForm.signIssueContent.imageurl:blankImage}"
                                             id="signIssue_img" style="width: 100%;height: 100%;position: absolute;margin:0px;padding:0px;background: none"/>
                                    </div>
                                    <div style="height: 189px;width: 410px;top: 192px;left: 33px;background:none;position: absolute;">
                                        <label
                                                th:utext="${missivePublishForm!=null
                            &&missivePublishForm.signIssueContent!=null
                            &&missivePublishForm.signIssueContent.contentText!=null?missivePublishForm.signIssueContent.contentText.replaceAll(' ','&nbsp;'):''}"
                                                style="font-family:'微软雅黑';width: 100%;height: 100%;position: absolute;margin:0px;padding:0px;background: none;border:none"></label>

                                    </div>





                                    <!--会签place-->
                                    <!--<div  style="height: 189px;width: 410px;top: 192px;left: 460px;position: absolute;">-->
                                        <!--<label id="counterSignBase30img" hidden/>-->
                                    <!--</div>-->
                                    <!--<div  style="height: 189px;width: 410px;top: 192px;left: 460px;;position: absolute;">-->
                                        <!--<img th:src="${missivePublishForm.counterSignContent!=null-->
                        <!--&&missivePublishForm.counterSignContent.imageurl!=null?missivePublishForm.counterSignContent.imageurl:blankImage}"-->
                                             <!--style="font-family:'微软雅黑';width: 100%;height: 100%;position: absolute;margin:0px;padding:0px;background: none;"/>-->
                                    <!--</div>-->
                                    <div style="height: 189px;width: 410px;top: 192px;left: 460px;background:none;position: absolute;">
                                        <label th:utext="${missivePublishForm!=null
                            &&missivePublishForm.counterSignContent!=null
                            &&missivePublishForm.counterSignContent.contentText!=null?missivePublishForm.counterSignContent.contentText.replaceAll(' ','&nbsp;'):''}"
                                                  style="font-family:'微软雅黑';width: 100%;height: 100%;position: absolute;margin:0px;padding:0px;background: none;border: none"></label>
                                    </div>


                                    <!--主送place-->
                                    <div style="top: 450px;left: 80px;position: absolute;">
                                        <label th:text="${mainsendGroup!=null?mainsendGroup:''}"
                                               style="font-family:'微软雅黑';word-wrap: break-word;width: 355px;"></label>
                                    </div>
                                    <div style="top: 450px;left: 490px;position: absolute;">
                                        <label th:text="${copytoGroup!=null?copytoGroup:''}" style="font-family:'微软雅黑'; word-wrap: break-word;width: 355px;"></label>
                                    </div>

                                    <!---->
                                    <div style="height: 35px;width: 280px;top: 618px;left: 160px;position: absolute;">
                                        <label  th:text="${missivePublishForm.drafterUser!=null
                            &&missivePublishForm.drafterUser.group!=null
                            &&missivePublishForm.drafterUser.group.groupName!=null?missivePublishForm.drafterUser.group.groupName:''}"
                                                style="width: 280px;font-family:'微软雅黑';"></label>
                                    </div>
                                    <div style="height: 35px;width: 280px;top: 665px;left: 145px;position: absolute;">
                                        <label th:text="${missivePublishForm.drafterUser!=null
                            &&missivePublishForm.drafterUser.name!=null?missivePublishForm.drafterUser.name:''}"
                                               style="font-family:'微软雅黑';width: 280px;/* border: solid */"></label>
                                    </div>
                                    <div style="height: 35px;width: 280px;top: 715px;left: 125px;position: absolute;">
                                        <label  th:text="${missivePublishForm.drafterUser!=null
                            &&missivePublishForm.drafterUser.tel!=null?missivePublishForm.drafterUser.tel:''}"
                                                style="width: 280px;font-family:'微软雅黑';"></label>
                                    </div>
                                    <div style="height: 35px;width: 280px;top: 760px;left: 125px;position: absolute;">
                                        <label th:text="${missivePublishForm.composeUser!=null
                            &&missivePublishForm.composeUser.name!=null?missivePublishForm.composeUser.name:''}"
                                               style="width: 280px;font-family:'微软雅黑';"></label>
                                    </div>

                                    <!--<div style="height: 35px;width: 250px;top: 618px;left: 608px;position: absolute;">-->
                                        <!--<label th:text="${missivePublishForm.dep_LeaderCheckUser!=null-->
                            <!--&&missivePublishForm.dep_LeaderCheckUser.name!=null?missivePublishForm.dep_LeaderCheckUser.name:''}"-->
                                               <!--style="width: 250px;font-family:'微软雅黑'; "></label>-->
                                    <!--</div>-->
                                    <div style="height: 44px;width: 150px;top: 607px;left: 608px;background:none;position: absolute;">
                                        <img th:src="${missivePublishForm.dep_LeaderCheckContent!=null
                        &&missivePublishForm.dep_LeaderCheckContent.imageurl!=null?missivePublishForm.dep_LeaderCheckContent.imageurl:blankImage}" style="width: 100%;height: 100%;position: absolute;margin:0px;padding:0px;background: none"/>
                                    </div>
                                    <div style="height: 44px;width: 150px;top: 607px;left: 608px;background:none;position: absolute;">
                                        <label

                                                th:utext="${missivePublishForm!=null
                            &&missivePublishForm.dep_LeaderCheckContent!=null
                            &&missivePublishForm.dep_LeaderCheckContent.contentText!=null?missivePublishForm.dep_LeaderCheckContent.contentText.replaceAll(' ','&nbsp;'):''}"
                                                style="font-family:'微软雅黑';width: 100%;height: 100%;position: absolute;margin:0px;padding:0px;background: none;border:none;padding-top: 14px">
                                        </label>
                                    </div>

                                    <div style="height: 35px;width: 270px;top: 665px;left: 585px;position: absolute;">
                                        <label  th:text="${missivePublishForm.officeCheckUser!=null
                            &&missivePublishForm.officeCheckUser.name!=null?missivePublishForm.officeCheckUser.name:''}"
                                                style="width: 270px;font-family:'微软雅黑';"></label>
                                    </div>
                                    <div style="height: 35px;width: 80px;top: 712px;left: 570px;position: absolute;">
                                        <!--<input th:Disabled="${#lists.contains(currentEditableField,'printCount')}?false:true" id="printCount" style="width: 80px;">-->
                                        <label id="printCount_lable"th:text="${missivePublishForm.printCount!=null?missivePublishForm.printCount:''}"
                                               style="width: 270px;font-family:'微软雅黑';"></label>
                                    </div>
                                    <div style="height: 35px;width: 270px;top: 760px;left: 530px;position: absolute;">
                                        <label id="CheckReader_lable"th:text="${missivePublishForm.checkReader!=null
                            &&missivePublishForm.checkReader.name!=null?missivePublishForm.checkReader.name:''}"
                                               style="font-family:'微软雅黑';width: 280px;"></label>
                                    </div>


                                    <!--公开属性-->
                                    <div th:if="${missivePublishForm.gov_info_attr==1}" style="font-family:'微软雅黑';position: absolute;height: 18px;width: 18px;top:818px;left: 224px;
    background-image: url('/img/selected.png');background-size:contain;background-repeat:no-repeat"></div>
                                    <div th:if="${missivePublishForm.gov_info_attr==2}" style="font-family:'微软雅黑';position: absolute;height: 18px;width: 18px;top:818px;left: 467px;
    background-image: url('/img/selected.png');background-size:contain;background-repeat:no-repeat"></div>
                                    <div th:if="${missivePublishForm.gov_info_attr==3}" style="font-family:'微软雅黑';position: absolute;height: 18px;width: 18px;top:868px;left: 224px;
    background-image: url('/img/selected.png');background-size:contain;background-repeat:no-repeat"></div>
                                    <!--标题-->
                                    <div style="height: 113px;width: 770px;top: 980px;left: 95px;position: absolute;">
                        <pre style="background: none;border: none">
                        <label th:utext="${missivePublishForm.missiveTittle!=null?missivePublishForm.missiveTittle.replaceAll(' ','&nbsp;'):''}"
                               style="font-family:'微软雅黑';word-wrap: break-word;width: 740px;"></label>
                        </pre>
                                        <!--<textarea th:Disabled="${#lists.contains(currentEditableField,'missiveTittle')}?false:true" id="missiveTittle" style="width: 100%;height: 100%;position: absolute;;"></textarea>-->
                                    </div>
                                    <!--附件标题-->
                                    <div style="height: 75px;width: 770px;top: 1130px;left: 95px;position: absolute;">
                        <pre style="background: none;border: none">
                        <label  th:utext="${missivePublishForm.attachmentTittle!=null?missivePublishForm.attachmentTittle.replaceAll(' ','&nbsp;'):''}"
                                style="word-wrap: break-word;width: 740px;font-family:'微软雅黑';"></label>
                        </pre>
                                    </div>

                                    <div style="height: 75px;width: 770px;top: 1250px;left: 95px;position: absolute;" hidden="hidden">
                                        <tr th:class="${#lists.contains(currentEditableField,'attachments')}?'hide':'trClass borderNone'" >
                                            <td class="borderNone" colspan="6">
                                                <div class="hr hr-double hr-dotted hr18"></div>
                                                <h3 class="header smaller lighter header-color-red">
                                                    <i class="icon-cloud-upload"></i>
                                                    上传附件
                                                </h3>
                                            </td>

                                        </tr>
                                        <tr th:class="${#lists.contains(currentEditableField,'attachments')}?'hide':'trClass borderNone'" hidden="hidden">
                                            <td class="borderNone" colspan="6">

                                                <div class="row">
                                                    <div class="col-xs-12">
                                                        <div class="demo-section k-header" id="filesDIV">
                                                            <input type="file" name="files" id="attachments"/>
                                                        </div>
                                                    </div>
                                                    <!-- /.col -->
                                                </div>
                                                <!-- /.row -->

                                            </td>

                                        </tr>
                                    </div>
                                    <div style="height: 75px;width: 770px;top: 1330px;left: 95px;position: absolute;">

                                    <tr class="trClass borderNone">
                                            <td class="borderNone" colspan="6">

                                                <div class="widget-box transparent">
                                                    <div style="left: -35px" class="widget-header widget-header-small" >
                                                        <h4 class="blue smaller">
                                                            <i class="icon-list orange"></i>
                                                            附件
                                                        </h4>

                                                        <div class="widget-toolbar action-buttons">
                                                            <a href="#" data-action="collapse">
                                                                <i class="icon-chevron-up"></i>
                                                            </a>
                                                        </div>
                                                    </div>

                                                    <div class="widget-body" >
                                                        <div class="widget-main padding-8" id="fileList">
                                                        </div>
                                                    </div>
                                                </div>
                                            </td>
                                        </tr>
                                    </div>






                                </div>

                            </div>


                        </div>

                        <!-- PAGE CONTENT ENDS -->
                    </div><!-- /.col -->
            </div><!-- /.page-content -->
        </div><!-- /.main-content -->


    </div><!-- /.main-container-inner -->

    <a href="#" id="btn-scroll-up" class="btn-scroll-up btn btn-sm btn-inverse">
        <i class="icon-double-angle-up icon-only bigger-110"></i>
    </a>
</div><!-- /.main-container -->

<!-- basic scripts -->

<!--[if !IE]> -->

<script src="/assets/js/jquery-2.0.3.min.js"></script>

<!-- <![endif]-->

<!--[if IE]>
<script src="/assets/js/jquery.1.10.2.min.js"></script>
<![endif]-->

<!--[if !IE]> -->

<script type="text/javascript">
    window.jQuery || document.write("<script src='/assets/js/jquery-2.0.3.min.js'>"+"<"+"/script>");
</script>

<!-- <![endif]-->

<!--[if IE]>
<script type="text/javascript">
    window.jQuery || document.write("<script src='/assets/js/jquery-1.10.2.min.js'>"+"<"+"/script>");
</script>
<![endif]-->

<script type="text/javascript">
    if("ontouchend" in document) document.write("<script src='/assets/js/jquery.mobile.custom.min.js'>"+"<"+"/script>");
</script>
<script src="/assets/js/bootstrap.min.js"></script>
<script src="/assets/js/typeahead-bs2.min.js"></script>

<script src="/js/fileList.wls.js" type="text/javascript"></script>

<!-- page specific plugin scripts -->

<!-- ace scripts -->

<script src="/assets/js/ace-elements.min.js"></script>
<script src="/assets/js/ace.min.js"></script>
<script src="/js/kendo.all.min.js"></script>

<script th:inline="javascript" type="text/javascript" >

    var instanceID = /*[[${instanceID}]]*/ 'instanceID';
    var missiviPublishForm = /*[[${missivePublishForm}]]*/ 'instanceID';
    var currentEditableField = /*[[${currentEditableField}]]*/ null;


    var resultFiles = [];//存放结果文件集合
    var initFiles = [];
    var fileUploadFlag = 0;
    var version = 0;
    if (missiviPublishForm.missiveInfo != null) {
        if (missiviPublishForm.missiveInfo.versions[0] != null) {
            if (missiviPublishForm.missiveInfo.versions[0].versionNumber != 0)
                version = missiviPublishForm.missiveInfo.versions[0].versionNumber;
        }
    }
    var filePath_version = 1;
    if (version == 0)
        filePath_version = version + 1;
    else
        filePath_version = version;
    $(function ($) {
        <!--上传文件相关js代码-->
//        var attachmentkendoUpload = $("#attachments").data("kendoUpload").options.files;

        if (missiviPublishForm.missiveInfo != null) {
            if (missiviPublishForm.missiveInfo.versions[0] != null) {
                if (missiviPublishForm.missiveInfo.versions[0].attachments.length != 0) {
                    for (var i = 0; i < missiviPublishForm.missiveInfo.versions[0].attachments.length; i++) {
                        var temp = {};
                        temp.extension = "." + missiviPublishForm.missiveInfo.versions[0].attachments[i].attachmentTittle.split('.')[missiviPublishForm.missiveInfo.versions[0].attachments[i].attachmentTittle.split('.').length - 1];//后缀
                        temp.name = missiviPublishForm.missiveInfo.versions[0].attachments[i].attachmentTittle;
                        temp.size = 1;
                        initFiles.push(temp);
                        //-------add list of attachments--->>>>>
                        fileListCreate("fileList", temp, "attachments", "filesDIV", currentEditableField);

                    }
                }
            }
        }
        resultFiles = initFiles;//将初始化的文件数字赋值给结果数据，然后将上传文件加入文件数组
        $("#attachments").kendoUpload({
            multiple: true,
            async: {
                saveUrl: '/missivePublish/upload/' + instanceID,
                autoUpload: false
            },
            localization: {
                select: "选择文件....",
                uploadSelectedFiles: "上传",
                statusFailed: "失败",
                headerStatusUploaded: " ",
                headerStatusUploading: "上传中...", cancel: "取消", remove: "删除", retry: "重试"
            },
            select: onSelect,
            success: onSuccess,
            files: initFiles
        });
        //set init_files visible be false;
        for (var initfiles_i = 0; initfiles_i < initFiles.length; initfiles_i++) {
            var hide_init_file = $("span[class='k-filename'][title='" + initFiles[initfiles_i].name + "']");
            for (var hide_init_file_i = 0; hide_init_file_i < hide_init_file.length; hide_init_file_i++) {
                $(hide_init_file[hide_init_file_i]).parent()[0].setAttribute("class", "hide");
            }
        }
    });

    //选择文件时触发事件
    function onSelect(e) {
        var file_extentAllowed=[".pdf",".PDF",".docx",".DOCX",".doc",".DOC",".xls",".XLS",".xlsx",".XLSX",".ppt",".pptx"];
        var resualt=e.files;
        $.each(resualt,function(index,val){
            var upfile_extent=val.extension;
            if(!($.inArray(upfile_extent, file_extentAllowed) > -1)){
                swal("不支持的文件格式","请上传 [ doc, xls, docx, xlsx,ppt,pptx ] 的 Office 文件","error");
                e.preventDefault();
            }
        })
    }

    //上传文件成功时触发事件
    function onSuccess(e) {
        // Array with information about the uploaded files
        var files = e.files;
        //将上传的文件写入到resultFiles数组中

        if (e.operation == "upload") {
            if (e.response == true) {
                addObjFromObj(e);//添加文件信息到文件数组
            }
        } else {
            if (e.response == true) {
                //初始文件对象中删除指定对象
                delObjFromObj(e);
            }
        }

        filePath_version = version + 1;

        $("#fileList").empty();
        for (var i = 0; i < resultFiles.length; i++) {
            var temp = resultFiles[i];
            //-------add list of attachments--->>>>>
            fileListCreate("fileList", temp, "attachments", "filesDIV", currentEditableField);
        }
        fileUploadFlag = 1;//上传过附件的标记
    }
    //初始文件对象中增加上传文件对象
    function addObjFromObj(e) {
        var files = e.files[0];

        var fileName = e.files[0].name;
        resultFiles = resultFiles.filter(function (el) {
            return el.name !== fileName;
        });

        var temp = {};
        temp.name = files.name;//文件名
        temp.extension = files.extension;//后缀名
        temp.size = 1;
        resultFiles.push(temp);
        var hide_span_file = $("span[class='k-filename'][title='" + e.files[0].name + "']");
        for (var span_file_i = 0; span_file_i < hide_span_file.length; span_file_i++) {
            $(hide_span_file[span_file_i]).parent()[0].setAttribute("class", "hide");
        }
    }

    function fileListCreate(fileListDiv_id, file, attachment_id, attachmentparent_id, editableElementList) {
        //fileListDiv_id--文件列表的id
        //file：文件{name;extension;size}
        //attachment_id:附件控件的id   //其必须有父级元素
        //attachmentparent_id:父级元素
        //editableElementList：当前可编辑控件集合的数组
        //pdfViewerURL:pdf浏览器URL
        //fileURL：文件下载的URL
        //fileUploadUrl  文件上传的URL//'/missivePublish/upload/'+instanceID,
        //fileRemoveURL;文件删除的URL// "/missivePublish/remove/"+instanceID;
        var pdfViewerURL = "/pdfViewer/web/viewer.html?file=";
        var fileURL = "/pdf/missivePublish/" + instanceID + "/" + filePath_version + "/" + file.name;
      //  var fileRemoveURL = "/missivePublish/remove/" + instanceID;
        var fileRemoveURL = "";

        var fileUploadUrl = "/missivePublish/upload/" + instanceID;
        createFileListElement(fileListDiv_id, file, attachment_id, attachmentparent_id, editableElementList, pdfViewerURL, fileURL, fileUploadUrl, fileRemoveURL);
    }
    var uploadattachments = $("#attachments").data("kendoUpload");
    if ($.inArray("attachments", currentEditableField) > -1) {
//            uploadattachments.disable();
    }
    else {
        uploadattachments.disable();
    }
    // enables the upload





</script>
<style>
    #missiveForm div label,#missiveForm div pre label,#missiveForm div textarea{
        font-size: 21px;
        font-family: "SimSun";
        color: #666;
    }
    #missiveForm div{
        margin-left: -12px;
        color: #666;
        font-size: 21px;
    }


</style>

<!-- inline scripts related to this page -->
</body>
</html>


