<!DOCTYPE html>
<html>
<head lang="en">
    <!-- basic styles -->
    <meta charset="utf-8"/>
    <title>编辑用户信息</title>
    <meta name="keywords" content=""/>
    <meta name="description" content=""/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

    <script th:replace="header :: header"></script>

    <link rel="stylesheet" href="/css/image-circle.css"/>

</head>

<body>

<!---用户信息展示-->
<div th:replace="navbar :: navbar(${user})"></div>

<div class="main-container" id="main-container">
    <script type="text/javascript">
        try {
            ace.settings.check('main-container', 'fixed')
        } catch (e) {
        }
    </script>

    <div class="main-container-inner">
        <a class="menu-toggler" id="menu-toggler" href="#">
            <span class="menu-text"></span>
        </a>


        <div th:replace="slider :: slidermenu(${'dbzx'})"></div>


        <div class="main-content">
            <div class="breadcrumbs" id="breadcrumbs">
                <script type="text/javascript">
                    try {
                        ace.settings.check('breadcrumbs', 'fixed')
                    } catch (e) {
                    }
                </script>

                <ul class="breadcrumb">
                    <li>
                        <i class="icon-home home-icon"></i>
                        <a href="/">首页</a>
                    </li>

                    <li>
                        <a th:href="@{/user/info/{userId}.html(userId=${usr.id})}">个人设置</a>
                    </li>

                </ul>
                <!-- .breadcrumb -->

                <div class="nav-search" id="nav-search">
                    <form class="form-search">
								<span class="input-icon">
									<input type="text" placeholder="搜索 ..." class="nav-search-input"
                                           id="nav-search-input" autocomplete="off"/>
									<i class="icon-search nav-search-icon"></i>
								</span>
                    </form>
                </div>
                <!-- #nav-search -->
            </div>

            <div class="page-content">

                <div class="tab-content no-border padding-24"
                     style="font-size: 14px;background-color:#fff;width:800px;font-family: Microsoft YaHei">
                    <h2 class="header blue bolder smaller center">用户基本信息</h2>

                    <div class="row">
                        <!--左侧-->
                        <div class="col-xs-12 col-sm-3 center">

                           <!-- <div style="margin:0 auto" id="avatar1" class="img-circle1">
                                <div id="avatar" class="img-circle"
                                     th:style="'background-image:url(/user/image/'+${usr.id}+');'"></div>
                            </div>-->
                            <span class="profile-picture">
								<img id="avatar" class="editable img-responsive" alt="用户头像" th:src="'/user/image/'+${usr.id}+''" />
							</span>
                            <!---头像-->

                           <!-- <div class="space space-4"></div>
                            <a href="#" class="btn btn-sm btn-block btn-success" id="joinGroup">
                                <i class="icon-plus-sign bigger-120"></i>
                                <span class="bigger-110">加入组群</span>
                            </a>

                            <div class="space space-4"></div>
                            <a href="#" class="btn btn-sm btn-block btn-primary" id="sendMessage">
                                <i class="icon-envelope-alt bigger-110"></i>
                                <span class="bigger-110">发送短消息</span>
                            </a>-->

<!--

                            <div class="space space-4"></div>
                            <div class="space space-4"></div>
                            <div class="space space-4"></div>
                            <div class="space space-4"></div>
                            <div class="space space-4"></div>
                            <div class="space space-4"></div>
                            <div class="space space-4"></div>
                            <div class="space space-4"></div>
                            <div class="space space-4"></div>
                            <div class="space space-4"></div>
                            <div class="space space-4"></div>
                            <div class="space space-4"></div>
-->

                           <!-- <div style="margin:0 auto" id="signature1" class="img-circle1">
                                <div id="signature" class="img-circle"
                                     th:style="'background-image:url(/user/getSignImg/'+${usr.id}+');background-size:contain;'"></div>
                                <input style="width: 200px;" type="file" name="files" id="signfiles"/> &lt;!&ndash;上传头像&ndash;&gt;
                            </div>-->
                          <!--  <input style="width: 100px;" type="file" name="files" id="signfiles"/> 上传头像-->
                        </div>
                        <!--右侧-->
                        <div class="col-xs-12 col-sm-9">
                            <!--<h4 class="blue">
                                <span class="middle"> </span>
                    <span class="label label-purple arrowed-in-right">
                        <i class="icon-circle smaller-80 align-middle"></i>
                        在线
                    </span>
                            </h4>-->

                            <form action="/user/edit" method="post" id="user-edit">
                                <div class="profile-user-info">
                                    <input id="userID" name="id" type="hidden" th:value="*{usr} ? *{usr.id} : '0'"/>

                                    <div class="profile-info-row">
                                        <div class="profile-info-name"> 用户名</div>

                                        <div class="profile-info-value">
                                            <input name="userName" type="text" style="width: 260px;" readonly
                                                   th:value="*{usr} ? *{usr.userName} : '(no user specified)'"/>
                                        </div>
                                    </div>

                                    <div class="profile-info-row" hidden="hidden">
                                        <div class="profile-info-name"> 密码</div>

                                        <div class="profile-info-value">
                                            <input name="password" type="password" style="width: 260px;"
                                                   th:value="*{usr}?*{usr.password}:'(no user specified)'" />
                                        </div>
                                    </div>

                                    <div class="profile-info-row">
                                        <div class="profile-info-name"> 姓名</div>

                                        <div class="profile-info-value">
                                            <input name="Name" type="text" style="width: 260px;"
                                                   th:value="*{usr} ? *{usr.Name} : '(no user specified)'"/>
                                        </div>
                                    </div>

                                    <div class="profile-info-row">
                                        <div class="profile-info-name"> 用户简称</div>

                                        <div class="profile-info-value">
                                            <input name="abrev" type="text" style="width: 260px;"
                                                   th:value="*{user} ? *{user.abrev} : '(no user specified)'"/>
                                        </div>
                                    </div>



                                    <div class="profile-info-row">
                                        <div class="profile-info-name"> 性别</div>

                                        <div class="profile-info-value" style="margin-left: 180px;">

                                            <input name="sex" type="radio" th:checked="${usr.sex=='男'} ? 'checked'"
                                                   value="男"/>&nbsp;男&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                            <input name="sex" type="radio" th:checked="${usr.sex=='女'} ? 'checked'"
                                                   value="女"/>&nbsp;女

                                        </div>
                                    </div>

                                    <div class="profile-info-row">
                                        <div class="profile-info-name"> 邮箱</div>

                                        <div class="profile-info-value">
                                            <input  name="email" type="email" style="width: 260px;"
                                                    th:value="*{usr}?*{usr.email}:'(no user specified)'" />
                                        </div>
                                    </div>

                                    <div class="profile-info-row">
                                        <div class="profile-info-name"> 手机</div>

                                        <div class="profile-info-value">
                                            <input name="tel" type="text" style="width: 260px;"
                                                   th:value="*{usr}?*{usr.tel}:'{no user specified}'"/>
                                        </div>
                                    </div>
                                    <div class="profile-info-row">
                                        <div class="profile-info-name">隶属单位/科室</div>

                                        <div class="profile-info-value">

                                            <input id="group" name="group" type="text" style="width: 260px;"
                                                   th:value="*{usr != null and user.group != null and usr.group.id!=0}?*{usr.group.id}:'(no user specified)'"/>
                                                   <!--th:value="*{user != null and user.group != null and user.group.group !=null or user.group.group.group !=null}?*{user.group.id}:'(no user specified)'"/>-->
                                        </div>
                                    </div>
                                    <div class="profile-info-row">
                                        <div class="profile-info-name"> 短信提醒</div>

                                        <div class="profile-info-value">
                                            <input name="msg" type="radio" th:checked="${usr.msgSend==true} ? 'checked'"
                                                   value="1"/>&nbsp;是&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                            <input name="msg" type="radio" th:checked="${usr.msgSend==false} ? 'checked'"
                                                   value="0"/>&nbsp;否
                                        </div>
                                    </div>
                                    <div class="profile-info-row">
                                        <div class="profile-info-name"> 邮件提醒</div>

                                        <div class="profile-info-value">
                                            <input name="emailSend" type="radio" th:checked="${usr.emailSend==true} ? 'checked'"
                                                   value="1"/>&nbsp;是&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                            <input name="emailSend" type="radio" th:checked="${usr.emailSend==false} ? 'checked'"
                                                   value="0"/>&nbsp;否
                                        </div>
                                    </div>
                                    <div class="profile-info-row">
                                        <div class="profile-info-name"> 手写板</div>

                                        <div class="profile-info-value">
                                            <input name="padEnable" type="radio" th:checked="${usr.padEnable==true} ? 'checked'"
                                                   value="1"/>&nbsp;是&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                            <input name="padEnable" type="radio" th:checked="${usr.padEnable==false} ? 'checked'"
                                                   value="0"/>&nbsp;否
                                        </div>
                                    </div>
                                    <div class="profile-info-row">
                                        <div class="profile-info-name"> 延时提醒</div>

                                        <div class="profile-info-value">
                                            <input id="delay" name="delay" type="text" style="width: 160px;"
                                                   th:value="*{usr != null}?*{usr.delayWarm}:'(no user specified)'"/>
                                            &nbsp;&nbsp;&nbsp;
                                            <input id="delayNum" name="delayNum" type="text" style="width: 50px;"
                                                   th:value="*{usr != null}?*{usr.delaynum}:'(no user specified)'"/>
                                            <label>小时</label>
                                            <!--th:value="*{user != null and user.group != null and user.group.group !=null or user.group.group.group !=null}?*{user.group.id}:'(no user specified)'"/>-->
                                        </div>
                                        <!--th:value="*{user != null and user.group != null and user.group.group !=null or user.group.group.group !=null}?*{user.group.id}:'(no user specified)'"/>-->
                                    </div>



                                </div>
                                <div class="space space-4"></div>
                                <div class="space space-4"></div>



                                <div class="center"><input style="left: -60px;" type="submit" id="submitBtn" class="btn btn-primary" value="提交"/>
                                    <a th:href="@{/user/info/{userid}.html(userid=${usr.id})}" class="btn btn-primary">取消</a></div>
                            </form>
                            <div class="hr hr-8 dotted"></div>
                        </div>
                        <!-- /span -->
                    </div>
                    <!-- /row-fluid -->
                </div>

            </div>
            <!-- /.page-content -->
        </div>
        <!-- /.main-content -->


    </div>
    <!-- /.main-container-inner -->

    <a href="#" id="btn-scroll-up" class="btn-scroll-up btn btn-sm btn-inverse">
        <i class="icon-double-angle-up icon-only bigger-110"></i>
    </a>
</div>
<!-- /.main-container -->


<!--[if !IE]> -->

<script type="text/javascript">
    window.jQuery || document.write("<script src='/assets/js/jquery-2.0.3.min.js'>" + "<" + "/script>");
</script>
<!-- <![endif]-->

<script src="/assets/js/bootstrap.min.js"></script>
<script src="/assets/js/x-editable/bootstrap-editable.min.js"></script>
<script src="/assets/js/x-editable/ace-editable.min.js"></script>
<script src="/assets/js/jquery.gritter.min.js"></script>

<!-- ace scripts -->

<script src="/assets/js/ace-elements.min.js"></script>
<script src="/assets/js/ace.min.js"></script>

<script>

    var userID = $('#userID').val();
    var saveURLSign="/uploadSign/"+userID;//郑小罗 2014/12/14 上传签名
    var saveUrl = "/upload/" + userID;

    $("#nav-search-input").keypress(function(event) {
        if ( event.which == 13 ) {
            event.preventDefault();

            var searchValue=event.currentTarget.value;
            if(searchValue==""){
                swal("请在搜索框输入关键字！");

            }else{
                self.location="/fullSearch/"+searchValue;

            }            //alert(searchValue);
        }

    });

    var data = [
        { text: "短信提醒", value: "m" },
        { text: "邮件提醒", value: "e" },
        { text: "不提醒", value: "n" }
    ];

    $("#files").kendoUpload({
        multiple: false,
        async: {
            saveUrl: saveUrl,
            removeUrl: "/remove",
            autoUpload: true
        },
        showFileList: false,
        localization: {
            select: "上传头像",
            uploadSelectedFiles: "上传",
            cancel: "取消",
            //statusFailed: "上传失败",
            //statusUploading: "正在上传",
            //statusUploaded: "上传完成",
            headerStatusUploaded: "",
            statusUploaded: ""
        },
        upload: onUpload,
        cancel: onCancel,
        success: onSuccess,
        error: onError,
        select:onSelect
        //template: kendo.template($('#fileTemplate').html())
    });

    //上载
    function onUpload(e) {
        // Array with information about the uploaded files

        var files = e.files;

        // Check the extension of each file and abort the upload if it is not image 仅能上传图片
        $.each(files, function () {
            if ((this.extension.toLowerCase() != ".jpg") & (this.extension.toLowerCase() != ".png") & (this.extension.toLowerCase() != ".img") & (this.extension.toLowerCase() != ".gif")) {
                alert("文件格式不正确！");
                e.preventDefault();
            }
        });
    }

    //取消
    function onCancel(e) {
        // Array with information about the uploaded files
        var files = e.files;
        alert("取消");
        // Process the Cancel event
    }
    //上传成功
    function onSuccess(e) {
        // Array with information about the uploaded files
        var files = e.files;

        console.log(files);

        var imageStr = e.files[0].name;


        $.ajax({
            url: "/user/edit/image",
            type: "POST",
            data: {imagePath: imageStr, id: userID},
            success: function (req) {

                $('#avatar').css("background-image", "url(/user/image/" + userID + ")");
            }

        });
    }

    //错误 仅在异步模式下起作用
    function onError(e) {
        // Array with information about the uploaded files
        var files = e.files;

        alert("上传错误");
        if (e.operation == "upload") {
            alert("Failed to upload " + files.length + " files");
        }
    }

    function addExtensionClass(extension) {
        switch (extension) {
            case '.jpg':
            case '.img':
            case '.png':
            case '.gif':
                return "img-file";
            default:
                return "default-file";
        }
    }


    //组别
    $("#group").kendoDropDownList({
        dataTextField: "groupname",
        dataValueField: "id",
        dataSource: {
            transport: {
                read: {
                    dataType: "json",
                    url: "/api/group/leafGroup"
                }
            }
        }
    });
    $("#delay").kendoDropDownList({
        dataTextField: "text",
        dataValueField: "value",
        dataSource: data,
        index: 0
    });
    var userEdit=$("#user-edit").kendoValidator({
        validateOnBlur: true,
        rules: {
            custom: function(input) {
                if (input.val()=="") {

                    console.log("input value:  "+input.val());

                    return false;
                }
                return true;
            }
        },
        messages:{

            custom: "必填项"
        }

    }).data("kendoValidator");


    $('#joinGroup').click(function(){

        alert("该系统版本此功能尚未开发！");

    });

    $('#sendMessage').click(function(){

        alert("该系统版本此功能尚未开发！");

    });
    <!--郑小罗 2014/12/14 上传用户签名-->
    $("#signfiles").kendoUpload({
        multiple: false,
        async: {
            saveUrl: saveURLSign,
            autoUpload: true
        },
        showFileList: false,
        localization: {
            select: "上传签名",
            uploadSelectedFiles: "上传",
            cancel: "取消",

            headerStatusUploaded: "",
            statusUploaded: ""
        },
        select:onSelect

    });
    function onSelect(e) {
        var file_extentAllowed=[".jpg",".png"];
        var resualt=e.files;
        $.each(resualt,function(index,val){
            var upfile_extent=val.extension;
            if(!($.inArray(upfile_extent, file_extentAllowed) > -1)){
                swal("不支持的文件格式","请上传图片文件","error");
                e.preventDefault();
            }
        })
    }
</script>

</body>
</html>